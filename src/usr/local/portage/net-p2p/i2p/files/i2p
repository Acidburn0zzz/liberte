#!/sbin/runscript
# Copyright 1999-2011 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: $

description="Starts I2P service."

pidfile=/var/run/i2p.pid
rundir=/var/run/i2p
i2puser=i2p
i2pgroup=i2p

# cf. wrapper.jvm_exit.timeout
timeout=65

wrapper=/usr/bin/wrapper
wrapper_cfg=/opt/i2p/wrapper.config


depend() {
	need net
}

start() {
	if [ ! -e ${rundir} ]; then
		mkdir -m 750 ${rundir}
		chown -h ${i2puser}:${i2pgroup} ${rundir}
	fi

	ebegin "Starting I2P"
	start-stop-daemon -S -q -u ${i2puser} -p ${pidfile} -bm -x ${wrapper} -- \
		${wrapper_cfg} wrapper.daemonize=FALSE
	eend $?
}

stop() {
	ebegin "Stopping I2P"
	start-stop-daemon -K -q -u ${i2puser} -p ${pidfile} -R ${timeout}
	eend $?
}
