#!/bin/sh -e

cableid=/usr/local/libexec/cable/cable-id
confdir=${XDG_CONFIG_HOME}/claws-mail

username=${SECURITY_HOME}/ssl/certs/username
hostname=${SECURITY_HOME}/tor/hidden_service/hostname

if address=`${cableid} 2>/dev/null`; then
    if ! grep -q "^address=${address}\$" ${confdir}/accountrc; then
        sed -i "s/^\(address=\).*/\1${address}/" ${confdir}/accountrc
    fi
fi

exec /usr/bin/claws-mail --alternate-config-dir ${confdir} 2>/dev/null "$@"
