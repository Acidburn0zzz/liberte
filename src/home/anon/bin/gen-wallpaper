#!/bin/sh -e

dir=${HOME}/config/images

height=`xwininfo -root | sed -n 's/^  Height: //p'`
wheight=${height}

# Wait for the taskbar to come up
w=
while [ ${#w} -lt 300  -a  ${height} = ${wheight} ]; do
    sleep 1

    if xprop -root _NET_WORKAREA | grep -q =; then
        wheight=`xprop -root '=$3' _NET_WORKAREA | cut -d= -f2`
    fi

    w=${w}X
done

calc=`xprop -root '=round(min($2-$0, $3-$1\) * 2/3\)' _NET_WORKAREA | cut -d= -f2`
size=`qalc -t "${calc}"`

exec rsvg-convert -h ${size} -o ${dir}/liberte-logo-wallpaper.png ${dir}/liberte-logo-nofont.svg
