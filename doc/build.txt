Creating Liberté Linux Live CD and Live USB images
--------------------------------------------------

As Liberté is a Gentoo-based distribution, you will need Gentoo
to build it. This is not true for the "burn-usb" tool, whose
requirements are listed  when it is run without arguments. The
build will work on x86 and AMD64 (creating an x86 live distro).

No special packages are necessary for the install, except for:
    sys-fs/squashfs-tools-3.x
    virtual/cdrtools
You will need to add
    >=sys-fs/squashfs-tools-4.0
to /etc/portage/package.mask.

In order to use LZMA compression when creating a SquashFS file system,
which affords a ~20% reduction in image size, you should install patched
SquashFS tools, see
  http://www.squashfs-lzma.org/, or take the ebuild from
  http://bugs.gentoo.org/207737 (squashfs-lzma-tools-3.4.ebuild)

Let's assume that the Liberté package is in $HOME/liberte,
and the temporary files should be created in /tmp/livecd.


1. Download stage3-i686-hardened and portage snapshots:

       $HOME/liberte/mkroot /tmp/livecd fresh

   The "fresh" parameter indicates that /tmp/livecd/src directory
   should be deleted and ovewritten with snapshots' contents.

   Without the second parameter, only the snapshots in /tmp/livecd/mirror
   will be updated.


2. Install software:

       $HOME/liberte/enter /tmp/livecd
       [copies configuration files]
       [you are now in a chroot environment]

       ./setup
       [installs software]

       exit
       $HOME/liberte/enter /tmp/livecd
       [overwrites updated configuration files]

       ...
       [here you can apply your own customizations]

       exit
       [returns from chroot, unmounts directories]


3. Create/synchronize /tmp/livecd/copy, a replica of /tmp/livecd/src

       $HOME/liberte/mkroot /tmp/livecd copy


4. Uninstall development software and libraries

       $HOME/liberte/enter /tmp/livecd copy
       [you are now in copy's chroot environment]

       ./setup-copy
       [uninstalls software, hit Enter several times]

       ...
       [here you can delete some more files]
       [see /tmp/packages-list for remaining packages]

       exit
       [returns from chroot, unmounts directories]


5. Create/synchronize /tmp/livecd/clean, a *pruned* replica of /tmp/livecd/copy

       $HOME/liberte/mkroot /tmp/livecd clean
       [inspect possibly unnecessary files]

       $HOME/liberte/enter /tmp/livecd clean
       exit
       [optionally, check that everything works]


6. Master the ISO (CD) and IMG (USB) files

       $HOME/liberte/mkdist /tmp/livecd
       [livecd.iso and liveusb.img are now in /tmp/livecd/dist]


7. "Burn" the USB image

       $HOME/liberte/burn-usb /tmp/livecd/dist/liveusb.img /dev/sdb
       [assuming /dev/sdb corresponds to a USB key]
       [run burn-usb without parameters to see requirements]
